agent: UXDesigner
role: UX Designer
stage: Design

input:
  - PRD

output:
  - UserFlow

prompt: |
  ä½ æ˜¯ä¸€å UX è®¾è®¡å¸ˆã€‚
  ä½ çš„ä»»åŠ¡æ˜¯åŸºäº PRD è®¾è®¡æ¸…æ™°çš„ç”¨æˆ·äº¤äº’æµç¨‹ï¼ˆUser Flowï¼‰ã€‚

  ä½ éœ€è¦æè¿°ï¼š
  - ç”¨æˆ·è·¯å¾„
  - é¡µé¢ / çŠ¶æ€èŠ‚ç‚¹
  - è·³è½¬ä¸è§¦å‘æ¡ä»¶

  æ³¨æ„ï¼š
  - UserFlow æ–‡ä»¶å¿…é¡»å†™å…¥ PM åˆ›å»ºçš„é¡¹ç›®ç›®å½•
  - è‡ªåŠ¨è¯†åˆ«é¡¹ç›®ç›®å½•ï¼ˆæ”¯æŒå¸¦åºå·çš„é¡¹ç›®è·¯å¾„ï¼‰
  - è‡ªåŠ¨è®°å½• UserFlow ç”Ÿæˆæ—¥å¿—
  - ä¿æŒä¸ PRD ç‰ˆæœ¬ä¸€è‡´çš„ç›®å½•å’Œå‘½åè§„åˆ™

rules:
  - ä¸æ¶‰åŠè§†è§‰é£æ ¼
  - ä¸è®¾è®¡ UI ç»„ä»¶
  - ä¸å¼•å…¥ PRD ä¹‹å¤–çš„æ–°åŠŸèƒ½

constraints:
  - output_format: markdown

hooks:
  after_stage:
    - name: generate_userflow_file
      description: >
        åœ¨ UXDesigner æ ¹æ® PRD ç”Ÿæˆ UserFlow åï¼Œå°† UserFlow å†™å…¥é¡¹ç›®ç›®å½•
        å¹¶è®°å½•æ—¥å¿—
      action: |
        import os
        import re
        from datetime import datetime

        workspace = os.environ.get("OPENCLAW_WORKSPACE", "~/openclaw_workspace")
        workspace = os.path.expanduser(workspace)

        prd_meta = input_artifacts.get("PRD", {}).get("meta", {})
        project_name = prd_meta.get("Project Name", None)
        if not project_name:
            project_name = "default_project"

        safe_title = re.sub(r'[\\/:*?"<>| ]', '_', project_name.strip())
        base_folder_name = f"project-{safe_title}"
        project_path = os.path.join(workspace, base_folder_name)

        # æ”¯æŒå¸¦åºå·çš„é¡¹ç›®è·¯å¾„
        counter = 1
        final_path = project_path
        while not os.path.exists(final_path):
            counter += 1
            final_path = f"{project_path}-{counter}"

        userflow_content = output_artifacts.get("UserFlow", {}).get("content", "")
        userflow_file_name = "project_userflow.md"
        userflow_file_path = os.path.join(final_path, userflow_file_name)

        with open(userflow_file_path, "w", encoding="utf-8") as f:
            f.write(userflow_content)

        # å†™æ—¥å¿—
        log_file = os.path.join(workspace, "project_creation.log")
        with open(log_file, "a", encoding="utf-8") as log:
            log.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | UserFlow å·²ç”Ÿæˆ: {userflow_file_path}\n")

        print(f"ğŸ“„ UserFlow æ–‡ä»¶å·²ç”Ÿæˆ: {userflow_file_path}")
