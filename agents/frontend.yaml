agent: FrontendEngineer
role: Frontend Engineer
stage: Implementation

input:
  - UIDesignSpec
  - APISpec

output:
  - FrontendImplementation

prompt: |
  ä½ æ˜¯ä¸€åå‰ç«¯å·¥ç¨‹å¸ˆã€‚
  ä½ çš„ä»»åŠ¡æ˜¯åŸºäº UIDesignSpec å’Œ APISpec å®ç°å‰ç«¯äº¤ä»˜æ–‡æ¡£ï¼ˆFrontendImplementationï¼‰ã€‚

  ä½ éœ€è¦è¯´æ˜ï¼š
  - é¡µé¢å®ç°æƒ…å†µ
  - æ¥å£è”è°ƒçŠ¶æ€
  - å·²çŸ¥é™åˆ¶
  - è¾“å‡ºå¿…é¡»æ¸…æ™°ã€å¯äº¤ä»˜ï¼Œä¸æ¶‰åŠçœŸå®ä»£ç å®ç°

  æ³¨æ„ï¼š
  - ä¸ä¿®æ”¹ UI è®¾è®¡æˆ– API æ–‡æ¡£
  - ä¸æ‰©å±• PRD ä¸­æœªå®šä¹‰åŠŸèƒ½
  - æ‰€æœ‰äº¤ä»˜æ–‡æ¡£å¿…é¡»å†™å…¥å¯¹åº”é¡¹ç›®ç›®å½•ï¼ˆæ ¹æ® PM æä¾›çš„ Project Nameï¼‰

rules:
  - ä¸ä¿®æ”¹ UI è®¾è®¡
  - ä¸å®ç°åç«¯é€»è¾‘
  - ä¸è‡ªè¡Œæ‰©å±•åŠŸèƒ½
  - æ‰€æœ‰è¾“å‡ºæ–‡æ¡£å¿…é¡»å†™å…¥é¡¹ç›®ç›®å½•å¹¶è®°å½•æ—¥å¿—

constraints:
  - output_format: markdown

hooks:
  after_stage:
    FrontendEngineer:
      - name: write_frontend_implementation
        description: >
          åœ¨ FrontendImplementation ç”Ÿæˆåï¼Œå°†æ–‡æ¡£å†™å…¥é¡¹ç›®ç›®å½•ï¼Œå¹¶è®°å½•æ“ä½œæ—¥å¿—ã€‚
        action: |
          import os
          import re
          import pathlib
          from datetime import datetime

          workspace = os.environ.get("OPENCLAW_WORKSPACE", "~/openclaw_workspace")
          workspace = os.path.expanduser(workspace)

          # ä» PRD Meta è·å– Project Name
          prd_meta = input_artifacts.get("PRD", {}).get("meta", {})
          project_name = prd_meta.get("Project Name", None)

          if not project_name:
              project_name = "default_project"

          safe_title = re.sub(r'[\\/:*?"<>| ]', '_', project_name.strip())
          base_folder_name = f"project-{safe_title}"
          project_path = os.path.join(workspace, base_folder_name)

          # æ”¯æŒåŒåé¡¹ç›®åŠ åºå·
          counter = 1
          final_path = context.get("project_path", project_path)
          while not os.path.exists(final_path) and counter < 20:
              counter += 1
              final_path = f"{project_path}-{counter}"

          # æ–‡æ¡£æ–‡ä»¶è·¯å¾„
          impl_file_name = "FrontendImplementation.md"
          impl_file_path = os.path.join(final_path, impl_file_name)
          content = output_artifacts.get("FrontendImplementation", {}).get("content", "")

          # å†™å…¥æ–‡ä»¶
          pathlib.Path(final_path).mkdir(parents=True, exist_ok=True)
          with open(impl_file_path, "w", encoding="utf-8") as f:
              f.write(content)

          # å†™æ—¥å¿—
          log_file = os.path.join(workspace, "project_creation.log")
          with open(log_file, "a", encoding="utf-8") as log:
              log.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å‰ç«¯äº¤ä»˜æ–‡æ¡£ç”Ÿæˆ: {impl_file_path}\n")

          print(f"ğŸ“„ FrontendImplementation å·²ç”Ÿæˆ: {impl_file_path}")
          print(f"âœ… æ“ä½œæ—¥å¿—å·²æ›´æ–°: {log_file}")
