agent: UIDesigner
role: UI Designer
stage: Design

input:
  - UserFlow

output:
  - UIDesignSpec

prompt: |
  ä½ æ˜¯ä¸€å UI è®¾è®¡å¸ˆã€‚
  ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ® User Flow è¾“å‡º UI è®¾è®¡è§„èŒƒã€‚

  ä½ éœ€è¦å®šä¹‰ï¼š
  - é¡µé¢ç»“æ„
  - ç»„ä»¶åˆ’åˆ†
  - åŸºç¡€è§†è§‰è§„èŒƒï¼ˆä¸è¦æ±‚ç¾æœ¯ç»†èŠ‚ï¼‰

  æ³¨æ„ï¼š
  - UIDesignSpec æ–‡ä»¶å¿…é¡»å†™å…¥ PM åˆ›å»ºçš„é¡¹ç›®ç›®å½•
  - è‡ªåŠ¨è¯†åˆ«é¡¹ç›®ç›®å½•ï¼ˆæ”¯æŒå¸¦åºå·çš„é¡¹ç›®è·¯å¾„ï¼‰
  - è‡ªåŠ¨è®°å½• UIDesignSpec ç”Ÿæˆæ—¥å¿—
  - ä¿æŒä¸ UserFlow å’Œ PRD ç‰ˆæœ¬ä¸€è‡´çš„ç›®å½•å’Œå‘½åè§„åˆ™

rules:
  - ä¸æ”¹å˜ User Flow
  - ä¸æ¶‰åŠä¸šåŠ¡é€»è¾‘
  - ä¸è®¨è®ºå‰ç«¯æ¡†æ¶å®ç°

constraints:
  - output_format: markdown

hooks:
  after_stage:
    - name: generate_uidesign_file
      description: >
        åœ¨ UIDesigner æ ¹æ® UserFlow ç”Ÿæˆ UIDesignSpec åï¼Œå°†æ–‡ä»¶å†™å…¥é¡¹ç›®ç›®å½•
        å¹¶è®°å½•æ—¥å¿—
      action: |
        import os
        import re
        from datetime import datetime

        workspace = os.environ.get("OPENCLAW_WORKSPACE", "~/openclaw_workspace")
        workspace = os.path.expanduser(workspace)

        # è·å–é¡¹ç›®åç§°
        prd_meta = input_artifacts.get("PRD", {}).get("meta", {})
        project_name = prd_meta.get("Project Name", None)
        if not project_name:
            project_name = "default_project"

        safe_title = re.sub(r'[\\/:*?"<>| ]', '_', project_name.strip())
        base_folder_name = f"project-{safe_title}"
        project_path = os.path.join(workspace, base_folder_name)

        # æ”¯æŒå¸¦åºå·çš„é¡¹ç›®è·¯å¾„
        counter = 1
        final_path = context.get("project_path", project_path)
        while not os.path.exists(final_path) and counter < 20:
            counter += 1
            final_path = f"{project_path}-{counter}"

        uidesign_content = output_artifacts.get("UIDesignSpec", {}).get("content", "")
        uidesign_file_name = "project_uidesignspec.md"
        uidesign_file_path = os.path.join(final_path, uidesign_file_name)

        with open(uidesign_file_path, "w", encoding="utf-8") as f:
            f.write(uidesign_content)

        # å†™æ—¥å¿—
        log_file = os.path.join(workspace, "project_creation.log")
        with open(log_file, "a", encoding="utf-8") as log:
            log.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | UIDesignSpec å·²ç”Ÿæˆ: {uidesign_file_path}\n")

        print(f"ğŸ“„ UIDesignSpec æ–‡ä»¶å·²ç”Ÿæˆ: {uidesign_file_path}")
