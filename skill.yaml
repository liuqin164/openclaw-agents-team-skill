name: devteam
display_name: OpenClaw Dev Team

version: 1.1.0
schema_version: 1.0

description: >
  A reusable, artifact-driven virtual software development team skill.
  Provides a full workflow from product idea to QA acceptance.
  Ensures strict artifact orchestration, stable agent roles,
  and deterministic project folder management.

author: LangGPT
license: MIT

# =========================
# 1. Entry & Core Files
# =========================
entry:
  system_prompt: system_prompt.md
  registry: registry.yaml
  artifacts: artifacts.yaml

# =========================
# 2. Project Contextï¼ˆå”¯ä¸€çœŸç›¸æºï¼‰
# =========================
project_context:
  required:
    - project_name
    - project_path
    - workspace
  readonly_after_init: true
  source:
    project_name:
      from:
        - PRD.meta.Project Name
        - RawIdea.title
    workspace:
      env: OPENCLAW_WORKSPACE
      default: ~/openclaw_workspace

# =========================
# 3. Agentsï¼ˆç»Ÿä¸€å®šä¹‰ï¼‰
# =========================
agents:

  PM:
    role: Product Manager
    stage: Planning
    input:
      - RawIdea
      - ChangeRequest
      - TestReport
      - Capability
    output:
      - PRD
    prompt: |
      ä½ æ˜¯ä¸€åèµ„æ·±äº§å“ç»ç†ï¼ˆPMï¼‰ã€‚
      ä½ çš„å”¯ä¸€èŒè´£æ˜¯å°†ç”¨æˆ·çš„åŽŸå§‹æƒ³æ³•æˆ–éœ€æ±‚å˜æ›´ï¼Œ
      è½¬åŒ–ä¸ºç»“æž„åŒ–ã€å¯æ‰§è¡Œçš„ PRD æ–‡æ¡£ã€‚

      Project Name è¦æ±‚ï¼š
      - ä»…åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
      - å¿…é¡»å†™å…¥ PRD Meta
      - ä½œä¸ºé¡¹ç›®ç›®å½•åçš„å”¯ä¸€æ¥æº

    rules:
      - ä¸æ¶‰åŠæŠ€æœ¯å®žçŽ°
      - ä¸æ‹†è§£ä»»åŠ¡ã€ä¸ä¼°ç®—å·¥æ—¶
      - ä¸æŽ¨æµ‹æœªæä¾›çš„éœ€æ±‚
      - åªè¾“å‡º PRD
      - PRD å¿…é¡»åŒ…å«å®Œæ•´ Meta åŒºå—
      - ç»´æŠ¤ active_dev / paused_dev / closed_dev çŠ¶æ€
      - å½“æ”¶åˆ° TestReport ä¸”çŠ¶æ€ä¸º rejected æ—¶ï¼Œå¿…é¡»å‘ç”¨æˆ·ç¡®è®¤æ˜¯å¦å®‰è£…/å¯ç”¨å¯¹åº”æµ‹è¯•å·¥å…·æˆ–çŽ¯å¢ƒ
      - è‹¥ç”¨æˆ·åŒæ„å¯ç”¨æµ‹è¯•èƒ½åŠ›ï¼Œéœ€æ›´æ–° Capabilityï¼Œå¹¶è®°å½•åˆ° ProjectContext ä¸­

    constraints:
      - output_format: markdown

  PJM:
    role: Project Manager
    stage: Planning

  UXDesigner:
    role: UX Designer
    stage: Design

  UIDesigner:
    role: UI Designer
    stage: Design

  Architect:
    role: System Architect
    stage: Design

  BackendEngineer:
    role: Backend Engineer
    stage: Implementation

  FrontendEngineer:
    role: Frontend Engineer
    stage: Implementation

  QA:
    role: QA Engineer
    stage: QA

# =========================
# 4. Artifact Policy
# =========================
artifact_policy:
  default_format: markdown
  enforce_schema: true
  versioning:
    enabled: true
    strategy: semver
  immutability:
    approved_readonly: true

# =========================
# 5. Workflow Policy
# =========================
workflow_policy:
  enforce_stage_order: true
  allow_parallel_execution: true
  allow_skip_stage: false

# =========================
# 6. Hooksï¼ˆåˆ†å±‚è¯­ä¹‰ï¼‰
# =========================
hooks:

  lifecycle:   # Skill ç”Ÿå‘½å‘¨æœŸ
    on_install:
      - validate_environment
      - init_artifact_store
    on_activate:
      - show_welcome
    on_uninstall:
      - cleanup_temp_artifacts

  workflow:    # Workflow ç”Ÿå‘½å‘¨æœŸï¼ˆå”¯ä¸€å…è®¸åŠ¨é¡¹ç›®ç»“æž„çš„åœ°æ–¹ï¼‰

    before_stage:
      PM:
        - name: create_project_folder
          description: >
            åœ¨ PRD ç”Ÿæˆå‰åˆå§‹åŒ–é¡¹ç›®ç›®å½•ï¼Œ
            å¹¶æ³¨å†Œ project_contextã€‚
          action: |
            import os, pathlib, re
            from datetime import datetime

            workspace = os.path.expanduser(
              os.environ.get("OPENCLAW_WORKSPACE", "~/openclaw_workspace")
            )

            raw = input_artifacts.get("RawIdea", {})
            title = raw.get("title", "default_project")
            safe = re.sub(r'[^a-zA-Z0-9_]', '_', title.strip())

            base = f"project-{safe}"
            path = os.path.join(workspace, base)
            i = 1
            final = path
            while os.path.exists(final):
                i += 1
                final = f"{path}-{i}"

            pathlib.Path(final).mkdir(parents=True, exist_ok=True)

            context["project_name"] = safe
            context["project_path"] = final
            context["workspace"] = workspace

            with open(os.path.join(final, "README.md"), "w", encoding="utf-8") as f:
                f.write(f"# {safe}\n\n")
                f.write("PRD: project_prd.md\n")

            log = os.path.join(workspace, "project_creation.log")
            with open(log, "a", encoding="utf-8") as l:
                l.write(f"{datetime.now()} | create project {final}\n")

    after_stage:
      PM:
        - name: write_prd_to_project
          description: >
            å°† PRD å†™å…¥é¡¹ç›®ç›®å½•å¹¶æ›´æ–° READMEã€‚
          action: |
            import os

            project_path = context["project_path"]
            prd = output_artifacts.get("PRD", {}).get("content", "")

            prd_path = os.path.join(project_path, "project_prd.md")
            with open(prd_path, "w", encoding="utf-8") as f:
                f.write(prd)

            print(f"ðŸ“„ PRD written to {prd_path}")

  internal:   # å†…éƒ¨æµç¨‹ Hookï¼ˆä¸å…è®¸æ”¹ç›®å½•ï¼‰
    evaluate_change_request:
      description: >
        åˆ¤æ–­ ChangeRequest æ˜¯å¦éœ€è¦æ–° PRD ç‰ˆæœ¬ã€‚
      action: |
        print("ðŸ”„ ChangeRequest evaluation triggered")
    show_welcome:
      description: >
        Show activation welcome message and usage guidance.
      action: |
        print("""
        ðŸ‘‹ æ¬¢è¿Žä½¿ç”¨ OpenClaw Dev Teamï¼ˆskill: devteamï¼‰

        è¿™æ˜¯ä¸€ä¸ªå¤š Agent åä½œçš„äº§å“å¼€å‘æµæ°´çº¿ï¼ŒåŒ…å«ï¼š
        - PMï¼šç”Ÿæˆ PRD
        - UXï¼šè®¾è®¡ç”¨æˆ·æµç¨‹
        - UIï¼šè¾“å‡ºç•Œé¢è§„èŒƒ
        - Backend / Frontendï¼šå®žçŽ°åŠŸèƒ½
        - QAï¼šæµ‹è¯•ä¸ŽéªŒæ”¶

        ðŸš€ å¿«é€Ÿå¼€å§‹ï¼š
        1. ç›´æŽ¥å‘Šè¯‰æˆ‘ä½ çš„æƒ³æ³•ï¼Œä¾‹å¦‚ï¼š
           â€œæˆ‘æƒ³åšä¸€ä¸ªâ€¦â€¦â€
        2. PM ä¼šè‡ªåŠ¨åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶ç”Ÿæˆ PRD
        3. æµæ°´çº¿ä¼šæŒ‰é˜¶æ®µè‡ªåŠ¨æŽ¨è¿›

        ðŸ’¡ æç¤ºï¼š
        - æ‰€æœ‰é¡¹ç›®æ–‡ä»¶éƒ½ä¼šä¿å­˜åœ¨ ~/openclaw_workspace/
        - ä½ å¯ä»¥éšæ—¶è®©æˆ‘è§£é‡Šå½“å‰é˜¶æ®µ

        çŽ°åœ¨å¯ä»¥ç›´æŽ¥æè¿°ä½ çš„éœ€æ±‚ ðŸ‘‡
        """)

# =========================
# 7. Runtime
# =========================
runtime:
  configurable:
    - domain_context
    - language
    - tone
  defaults:
    language: zh
    tone: concise
  resume_policy:
    on_restart: continue_from_artifact_state

# =========================
# 8. Compatibility
# =========================
compatibility:
  openclaw_min_version: ">=0.5.0"
  platforms:
    - local
    - cloud
    - embedded

# =========================
# 9. Documentation
# =========================
docs:
  readme: README.md
  examples:
    - examples/basic_run.md
    - examples/custom_agent_override.md
