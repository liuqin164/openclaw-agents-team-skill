version: 1.1.0
type: artifact-schema
name: artifact-driven-dev-team-artifacts

description: >
  Artifact protocol definitions for an artifact-driven virtual
  software development team running on OpenClaw.
  Fully aligned with workflow-registry stage transitions.

# =========================
# 1. Global Artifact Rules
# =========================
global:
  default_format: markdown
  allowed_status:
    - draft
    - approved
    - rejected
    - completed

  immutability:
    approved_artifact_readonly: true
    new_version_required_on_change: true

# =========================
# 2. Artifact Definitions
# =========================
artifacts:

  ProjectContext:
    description: >
      项目全局上下文，作为整个流水线的唯一事实源（Single Source of Truth）。
      包含项目名称、物理路径、版本信息等。
    schema:
      ProjectName:
        type: string
        description: 项目名称（用于展示与标识）
      ProjectPath:
        type: string
        description: 项目在文件系统中的绝对路径
      Version:
        type: string
        description: PRD 版本号（如 v1.0 / v1.1）
      CreatedAt:
        type: string
        description: 项目创建时间（ISO8601）
      Capabilities:
        type: object
        description: 测试/运行能力与工具可用性记录（可选）
      GovernanceMode:
        type: string
        description: 项目控制权模式（human-in-loop 或 autopilot）
      GovernancePhase:
        type: string
        description: 当前治理阶段（需求收集/阶段推进/交付）

  # -------- Input --------
  RawIdea:
    description: User provided raw product idea
    producer: User
    consumers: [PM]
    status_flow: [draft]

  ChangeRequest:
    description: Requirement change request submitted during development
    producer: User
    consumers: [PM]
    status_flow: [draft, approved, rejected]
    required_sections:
      - 变更背景
      - 新增或修改的需求
      - 变更原因
      - 紧急程度

  Capability:
    description: Test environment and tooling capability declaration
    producer: PM
    consumers: [QA]
    status_flow: [draft, approved]

  GovernanceState:
    description: Governance mode/state machine snapshot
    producer: PM
    consumers: [System, User]
    status_flow: [draft, approved]
    schema:
      mode:
        type: string
        description: human-in-loop 或 autopilot
      phase:
        type: string
        description: 需求收集 / 阶段推进 / 交付
      stage_gate:
        type: string
        description: 当前是否允许进入下一阶段（wait/continue）
      updated_at:
        type: string
        description: 状态更新时间（ISO8601）

  ExecResult:
    description: Standardized execution result for shell commands
    producer: System
    consumers: [QA, PM]
    status_flow: [completed]
    schema:
      command:
        type: string
        description: 原始执行命令
      exit_code:
        type: integer
        description: 进程退出码
      stdout:
        type: string
        description: 标准输出
      stderr:
        type: string
        description: 标准错误
      interpretation:
        type: string
        description: 退出码语义解释（如 grep 未匹配视为非失败）
      is_failure:
        type: boolean
        description: 是否为真实失败（而非无匹配/无进程）

  # -------- Planning --------
  PRD:
    description: Product Requirement Document
    producer: PM
    consumers: [PJM, UXDesigner, Architect]
    status_flow: [draft, approved, rejected]
    required_sections:
      - Meta
      - 项目背景
      - 项目目标
      - 用户画像
      - 使用场景
      - 功能需求
      - 非功能需求
      - 不在范围内
      - 验收标准

    meta_validation:
      required_fields:
        - PRD 名称
        - PRD 版本
        - PRD 状态
        - 创建日期
        - 创建人（Agent）
        - 所属主线（Track）
        - 上一版本 PRD
        - 变更类型
        - Project Name

  Backlog:
    description: Task backlog derived from PRD
    producer: PJM
    consumers:
      - UXDesigner
      - UIDesigner
      - Architect
      - BackendEngineer
      - FrontendEngineer
      - QA
    status_flow: [draft, approved]

  PlanningStageSummary:
    description: Planning stage completion anchor
    producer: PM
    consumers: [System]
    status_flow: [completed]

  # -------- Design --------
  UserFlow:
    description: User interaction flow definition
    producer: UXDesigner
    consumers: [UIDesigner, Architect]
    status_flow: [draft, approved]

  UIDesignSpec:
    description: UI design specification
    producer: UIDesigner
    consumers: [FrontendEngineer]
    status_flow: [draft, approved]

  APISpec:
    description: API specification
    producer: Architect
    consumers: [BackendEngineer, FrontendEngineer]
    status_flow: [draft, approved]

  DBSchema:
    description: Database schema definition
    producer: Architect
    consumers: [BackendEngineer]
    status_flow: [draft, approved]

  DesignStageSummary:
    description: Design stage completion anchor
    producer: Architect
    consumers: [System]
    status_flow: [completed]

  # -------- Implementation --------
  BackendImplementation:
    description: Backend delivery bound to project backend directory
    producer: BackendEngineer
    consumers: [QA]
    status_flow: [completed]
    binding:
      directory: backend/

  FrontendImplementation:
    description: Frontend delivery bound to project frontend directory
    producer: FrontendEngineer
    consumers: [QA]
    status_flow: [completed]
    binding:
      directory: frontend/

  AgentProgressReport:
    description: Agent progress report for implementation summary aggregation
    producer: BackendEngineer
    consumers: [System]
    status_flow: [completed]

  ImplementationStageSummary:
    description: Implementation stage completion anchor
    producer: BackendEngineer
    consumers: [System]
    status_flow: [completed]

  # -------- QA --------
  TestReport:
    description: QA test and acceptance report
    producer: QA
    consumers: [User, PM]
    status_flow: [draft, approved, rejected]

  BugReport:
    description: Bug report generated during QA
    producer: QA
    consumers: [BackendEngineer, FrontendEngineer]
    status_flow:
      - draft
      - approved
      - fixed
      - closed
